import smtplib, ssl
import math, random

from pentesting.model.User import User


port = 587
smtp_server = "smtp.gmail.com"
sender_email = "tpsecurite10@gmail.com"
password="tpsecuriteisthebest"

def generate_code() :
    digits = "0123456789"
    code = ""
    for i in range(5) :
        code += digits[math.floor(random.random() * 10)]
    return code

def sendVerificationCode(user: User):
    verif_code = generate_code()
    message = f"""\
Subject: Your verification code

    Hello {user.firstname} {user.lastname}, This is your verification code: {verif_code} """
    context = ssl.create_default_context()
    with smtplib.SMTP(smtp_server, port) as server:
        server.ehlo()
        server.starttls(context=context)
        server.ehlo()
        server.login(sender_email, password)
        server.sendmail(sender_email, user.email, message)
    return verif_code
